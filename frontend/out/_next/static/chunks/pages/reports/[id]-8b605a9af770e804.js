(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7193],{7849:function(e,t,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports/[id]",function(){return o(4236)}])},4236:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return u}});var r=o(5893),a=o(7294),s=o(1163),n=o(1664),l=o.n(n),i=o(6153),c=o(610),d=o(1491),h=o(7411);let g=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];console.log("generateReportPDF started with:",{reportId:null==e?void 0:e.id,photosCount:Array.isArray(t)?t.length:"not an array"}),t=Array.isArray(t)?t:[],e=e||{};try{let r;try{r=(await Promise.all([o.e(7847),o.e(3412)]).then(o.bind(o,1819))).jsPDF,console.log("jsPDF imported successfully from jspdf module")}catch(e){console.error("Error importing jsPDF as a named export:",e);try{r=(await Promise.all([o.e(7847),o.e(3412)]).then(o.bind(o,1819))).default,console.log("jsPDF imported successfully as default export")}catch(t){throw console.error("Error importing jsPDF as default export:",t),Error("Failed to import jsPDF library: "+e.message)}}if(!r)throw Error("jsPDF library could not be loaded");console.log("Creating new jsPDF instance");let a=new r({orientation:"portrait",unit:"mm",format:"a4",compress:!0,putOnlyUsedFonts:!0,floatPrecision:16}),s=15;a.setFontSize(20),a.setTextColor(59,130,246),a.text("tenantli",15,20),a.setFontSize(12),a.setTextColor(100,100,100),a.text("Property Reporting System",15,25),a.setDrawColor(200,200,200),a.line(15,30,195,30),s=40,a.setFontSize(18),a.setTextColor(0,0,0);let n=e.title?String(e.title):"Property Report";a.text("Property Report: "+n,15,s),s+=10,a.setFontSize(14),a.setTextColor(50,50,50);let l="General Observation";switch(e.type){case"move-in":l="Pre-Move-In Report";break;case"move-out":l="Post-Move-Out Report"}a.text(l,15,s),s+=15,a.setFontSize(12),a.setTextColor(80,80,80),a.text("Property Address:",15,s),s+=7,a.setTextColor(0,0,0);let i=e.address?String(e.address):"Address not available",c=a.splitTextToSize(i,170);a.text(c,15,s),s+=7*c.length+5,a.setFontSize(12),a.setTextColor(80,80,80),a.text("Report Date:",15,s),s+=7,a.setTextColor(0,0,0);let d="Date not available";try{e.created_at&&(d=new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}))}catch(t){if(console.error("Error formatting date:",t),e.created_at){let t=new Date(e.created_at);d=t.toLocaleDateString("en-US")+" "+t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}}if(a.text(d,15,s),s+=10,e.approval_status){if(s+=5,"approved"===e.approval_status)a.setTextColor(16,185,129),a.text("APPROVED BY LANDLORD",15,s);else if("rejected"===e.approval_status&&(a.setTextColor(239,68,68),a.text("REJECTED BY LANDLORD",15,s),e.rejection_message)){s+=7,a.setFontSize(10),a.text("Rejection Reason:",15,s),s+=5;let t=String(e.rejection_message||""),o=a.splitTextToSize(t,170);a.text(o,15,s),s+=6*o.length+5}s+=10}if((e.tenant_name||e.tenant_email||e.creator_name)&&(a.setFontSize(12),a.setTextColor(80,80,80),a.text("Tenant Information:",15,s),s+=7,a.setTextColor(0,0,0),a.setFontSize(11),e.tenant_name?(a.text("Name: "+String(e.tenant_name),15,s),s+=6):e.creator_name&&(a.text("Name: "+String(e.creator_name),15,s),s+=6),e.tenant_email&&(a.text("Email: "+String(e.tenant_email),15,s),s+=6),s+=10),e.description){a.setFontSize(12),a.setTextColor(80,80,80),a.text("Report Description:",15,s),s+=7,a.setTextColor(0,0,0),a.setFontSize(11);let t=String(e.description||""),o=a.splitTextToSize(t,170);a.text(o,15,s),s+=6*o.length+10}let h={};if(t.forEach(e=>{if(e&&e.tags&&e.tags.length>0){let t=e.tags[0];h[t]||(h[t]=[]),h[t].push(e)}}),Object.keys(h).length>0){s>237&&(a.addPage(),s=15),a.setFontSize(14),a.setTextColor(0,0,0),a.text("Rooms and Photos",15,s),s+=10;let e=Object.entries(h);for(let t=0;t<e.length;t++){let[o,r]=e[t];a.setFontSize(12),a.setTextColor(30,64,175),a.text(String(o)+" ("+String(r.length)+" photos)",15,s),s+=6;let n=r.slice(0,2).filter(e=>e.base64);if(n.length>0)for(let e=0;e<n.length;e++){let t=n[e];try{if(s>237&&(a.addPage(),s=15,a.setFontSize(12),a.setTextColor(30,64,175),a.text(String(o)+" (continued)",15,s),s+=8),t.note){a.setFontSize(10),a.setTextColor(0,0,0);let o=String(t.note||"Photo "+(e+1)),r=a.splitTextToSize(o,165);a.text(r,20,s),s+=5*r.length+3}if(t.base64)try{let e=t.base64;e.startsWith("data:image")||(e="data:image/jpeg;base64,"+e);a.setFillColor(250,250,250),a.roundedRect(20,s,170,78,2,2,"F"),a.addImage(e,"JPEG",25,s+4,160,70,"","MEDIUM"),a.setDrawColor(220,220,220),a.rect(25,s+4,160,70),s+=82}catch(e){console.error("Error processing image:",e),s+=10}}catch(e){console.error("Error adding room photo to PDF:",e)}}else a.setFontSize(9),a.setTextColor(100,100,100),a.text("No viewable photos available for this room.",20,s),s+=5;s+=8,t<e.length-1&&s>252&&(a.addPage(),s=15)}}return a.setFontSize(8),a.setTextColor(150,150,150),a.text("Report ID: "+String(e.id||"")+" | Generated on "+new Date().toLocaleDateString("en-US"),15,285),a.text("tenantli Report System",195,285,{align:"right"}),a}catch(e){throw console.error("Error generating PDF:",e),e}},m="localhost"!==window.location.hostname?"https://api.tenantli.ai/api":"http://localhost:5050/api";window.location.hostname;let p="http://localhost:5050",x="https://api.tenantli.ai";function u(){let{user:e,loading:t}=(0,d.a)(),[n,u]=(0,a.useState)(null),[f,w]=(0,a.useState)([]),[v,y]=(0,a.useState)(!0),[j,b]=(0,a.useState)(!0),[N,k]=(0,a.useState)(!1),P=(0,a.useRef)(null),D=(0,s.useRouter)(),{id:S}=D.query,L=async e=>{try{console.log("Fetching image:",e);let t=await fetch(e,{mode:"cors",cache:"no-cache",headers:{Accept:"image/jpeg, image/png, image/*"}});if(!t.ok)throw Error("Image fetch failed: ".concat(t.status));let o=await t.blob();return new Promise((e,t)=>{let r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=t,r.readAsDataURL(o)})}catch(e){return console.error("Error fetching image as base64:",e),null}};(0,a.useEffect)(()=>{if(!t&&!e){D.push("/login");return}S&&_()},[S,e,t,D]),(0,a.useEffect)(()=>{n&&C()},[n]);let _=async()=>{try{console.log("Fetching report details:",S),console.log("Using API URL:",m);let e=null;try{let t=await c.E.reports.getById(S);console.log("Report details response:",t.data),e={...t.data}}catch(t){console.error("Standard API call failed:",t);try{let t=(await o.e(9204).then(o.bind(o,9204))).default,r=localStorage.getItem("token"),a="localhost"!==window.location.hostname,s=await t.get("".concat(a?"https://api.tenantli.ai":"http://localhost:5050","/api/reports/").concat(S),{headers:r?{Authorization:"Bearer ".concat(r)}:{}});console.log("Alternative API call successful:",s.data),e={...s.data}}catch(e){throw console.error("Alternative API call also failed:",e),t}}e.uuid?console.log("Report UUID:",e.uuid):(console.warn("Report data missing UUID field, generating a temporary one for sharing purposes"),e.uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),console.log("Generated temporary UUID:",e.uuid)),u(e)}catch(t){console.error("Report fetch error:",t);let e="An error occurred while loading report information.";t.response&&(console.error("API response error:",t.response.data),e=t.response.data.message||e),console.error(e)}finally{y(!1)}},C=async()=>{try{console.log("Fetching photos for report:",n.id);let e=[];try{let t=await c.E.photos.getByReport(n.id);console.log("Photos response:",t.data),Array.isArray(t.data)?e=t.data:console.error("Invalid photos data format:",t.data)}catch(t){console.error("Standard photos API call failed:",t);try{let t=(await o.e(9204).then(o.bind(o,9204))).default,r=localStorage.getItem("token"),a="localhost"!==window.location.hostname,s=await t.get("".concat(a?"https://api.tenantli.ai":"http://localhost:5050","/api/photos/report/").concat(n.id),{headers:r?{Authorization:"Bearer ".concat(r)}:{}});console.log("Alternative photos API call successful:",s.data),Array.isArray(s.data)?e=s.data:console.error("Invalid photos data format from alternative API:",s.data)}catch(t){console.error("Alternative photos API call also failed:",t),e=[]}}if(e.length>0){console.log("Received ".concat(e.length," photos"));let t=(0,h.Ni)(e);console.log("Enhanced photos with URLs:",t),w(t)}else console.log("No photos to display"),w([])}catch(t){console.error("Photos fetch error:",t);let e="An error occurred while loading photos.";t.response&&(console.error("API response error:",t.response.data),e=t.response.data.message||e),console.error(e),w([])}finally{b(!1)}},A=async()=>{if(confirm("Are you sure you want to delete this report? This action cannot be undone."))try{console.log("Deleting report:",S),await c.E.reports.delete(S),console.log("Report deleted"),console.log("Report successfully deleted."),D.push("/reports")}catch(t){console.error("Report delete error:",t);let e="An error occurred while deleting the report.";t.response&&(console.error("API response error:",t.response.data),e=t.response.data.message||e),toast.error(e)}},R=async e=>{if(confirm("Are you sure you want to delete this photo? This action cannot be undone."))try{console.log("Deleting photo:",e),await c.E.photos.delete(e),console.log("Photo deleted"),w(f.filter(t=>t.id!==e)),console.log("Photo successfully deleted.")}catch(t){console.error("Photo delete error:",t);let e="An error occurred while deleting the photo.";t.response&&(console.error("API response error:",t.response.data),e=t.response.data.message||e),toast.error(e)}},F=()=>n&&n.uuid?"".concat("https://mobile.tenantli.ai","/reports/shared/").concat(n.uuid):(console.error("Report missing UUID:",n),""),T=async()=>{let e=F();if(!e){console.error("Cannot create share link: Report UUID is missing.");return}let t="".concat("https://mobile.tenantli.ai","/reports/shared/id-").concat(n.id),o=e||t;if(navigator.clipboard&&window.isSecureContext)try{await navigator.clipboard.writeText(o),console.log("Share link copied using Clipboard API!"),alert("Link copied to clipboard!");return}catch(e){console.warn("Clipboard API failed:",e)}try{let e=/iPad|iPhone|iPod/.test(navigator.userAgent),t=/Android|webOS|iPad|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);if(e||t){console.log("Using mobile-optimized copy method");let t=document.createElement("input");if(t.value=o,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),e){t.contentEditable=!0,t.readOnly=!1;let e=document.createRange();e.selectNodeContents(t);let o=window.getSelection();o.removeAllRanges(),o.addRange(e),t.setSelectionRange(0,999999)}else t.select();let r=document.execCommand("copy");if(document.body.removeChild(t),r){console.log("Mobile copy successful!"),alert("Link copied to clipboard!");return}}}catch(e){console.warn("Mobile copy method failed:",e)}try{let e=document.createElement("textarea");e.value=o,e.style.position="fixed",e.style.left="-999999px",e.style.top="-999999px",document.body.appendChild(e),e.focus(),e.select();let t=document.execCommand("copy");e.remove(),t?(console.log("Legacy copy successful!"),alert("Link copied to clipboard!")):(console.error("Legacy copy command failed"),alert("Unable to automatically copy. Please copy this link manually: ".concat(o)))}catch(e){console.error("All clipboard methods failed:",e),alert("Unable to copy automatically. Please copy this link manually: ".concat(o))}},E=async()=>{try{k(!0),console.log("PDF hazırlanıyor..."),console.log("Starting PDF generation with:",{report:n?{id:n.id,uuid:n.uuid,title:n.title}:"No report",photosCount:f?f.length:"No photos"});let{jsPDF:e}=await Promise.all([o.e(7847),o.e(3412)]).then(o.bind(o,1819));new e().text("Test PDF Generation",10,10),console.log("Test PDF created successfully");try{if(!n)throw Error("Report data is missing");let e=[];if(f&&f.length>0){console.log("Processing photos for PDF...");let t=new Map;for(let o of f)try{if(o&&o.url){let r="localhost"!==window.location.hostname?"https://api.tenantli.ai":"http://localhost:5050",a=o.url;a.startsWith("http")||(a=a.startsWith("/")?"".concat(r).concat(a):"".concat(r,"/uploads/").concat(a));let s="Other";o.tags&&o.tags.length>0&&(s=o.tags[0]);let n=t.get(s)||0;if(n<2){console.log("Fetching image for ".concat(s,":"),a);let r=await L(a);r?(o.base64=r,t.set(s,n+1),e.push(o),console.log("Successfully loaded image for ".concat(s))):console.log("Failed to load image for ".concat(s))}}}catch(e){console.error("Error processing photo for PDF:",e)}console.log("Enhanced photos with base64 data:",e.length,"from rooms:",[...t.keys()])}let t=await g(n,e);if(!t)throw Error("PDF generation returned null");let o=(n.id||"unknown").toString().replace(/[^a-z0-9]/gi,"_"),r=new Date().toISOString().slice(0,10),a="tenantli_Report_".concat(o,"_").concat(r,".pdf");console.log("PDF generated, saving with filename:",a),console.log("PDF generated successfully, starting download");try{t.save(a),console.log("PDF saved with filename:",a),console.log("PDF başarıyla oluşturuldu!")}catch(e){console.error("Error during PDF save operation:",e);try{console.log("Trying alternative PDF download method");let e=t.output("datauristring"),o=document.createElement("a");o.href=e,o.download=a,o.click(),console.log("Alternative download method executed"),console.log("PDF başarıyla indirildi!")}catch(t){throw console.error("Alternative save method also failed:",t),e}}}catch(t){console.error("Detailed PDF generation error:",t);try{let t=new e;t.text("tenantli Report (Simplified Version)",20,20),t.text("There was an error generating the full report.",20,30),t.text("Report ID: ".concat((null==n?void 0:n.id)||"Unknown"),20,40),t.text("Date: ".concat(new Date().toLocaleDateString()),20,50),t.save("tenantli_Simple_Report_".concat(new Date().getTime(),".pdf")),console.warn("Generated a simplified PDF due to an error with the full report.");return}catch(e){throw console.error("Even fallback PDF failed:",e),t}}}catch(e){console.error("Error generating PDF:",e),console.error("PDF generation failed: ".concat(e.message||"Unknown error"))}finally{k(!1)}};return v||t?(0,r.jsx)(i.Z,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl animate-fadeIn",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-indigo-700 mb-6",children:"Report Details"}),(0,r.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-indigo-500"})})]})}):n?(0,r.jsx)(i.Z,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl animate-fadeIn",children:[(0,r.jsxs)("div",{className:"flex items-center mb-6",children:[(0,r.jsx)("button",{onClick:()=>D.back(),className:"mr-4 text-gray-600 hover:text-gray-900","aria-label":"Back",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-indigo-700",children:"Report Details"})]}),(0,r.jsxs)("div",{ref:P,className:"bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 mb-8",children:[(0,r.jsxs)("div",{className:"bg-indigo-50 p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-indigo-700",children:n.title}),(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full\n                ".concat("move-in"===n.type?"bg-green-100 text-green-700":"move-out"===n.type?"bg-red-100 text-red-700":"bg-blue-100 text-blue-700"),children:(e=>{switch(e){case"move-in":return"Pre-Move-In";case"move-out":return"Post-Move-Out";case"general":return"General Observation";default:return"Unknown"}})(n.type)})]}),(0,r.jsxs)("div",{className:"flex space-x-2 w-full sm:w-auto",children:[(0,r.jsxs)("button",{onClick:T,className:"btn btn-secondary flex items-center py-1 flex-1 sm:flex-initial justify-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"Share"]}),(0,r.jsxs)("button",{onClick:E,disabled:N,className:"btn btn-primary flex items-center py-1 flex-1 sm:flex-initial justify-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),N?"Generating...":"Download PDF"]})]})]}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Property Address"}),(0,r.jsx)("p",{className:"text-gray-800 mt-1",children:n.address})]}),n.tenant_name||n.tenant_email?(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Tenant Information"}),(0,r.jsxs)("div",{className:"text-gray-800 mt-1",children:[n.tenant_name&&(0,r.jsxs)("p",{className:"flex items-center gap-1",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),n.tenant_name]}),n.tenant_email&&(0,r.jsxs)("p",{className:"flex items-center gap-1 mt-1",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),n.tenant_email]}),n.approval_status&&(0,r.jsx)("p",{className:"flex items-center gap-1 mt-2",children:(0,r.jsx)("span",{className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ".concat("approved"===n.approval_status?"bg-green-100 text-green-700":"rejected"===n.approval_status?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"),children:"approved"===n.approval_status?"Approved by tenant":"rejected"===n.approval_status?"Rejected by tenant":"Pending approval"})})]})]}):null,n.description&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Report Description"}),(0,r.jsx)("p",{className:"text-gray-800 mt-1",children:n.description})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Report Date & Time"}),(0,r.jsxs)("div",{className:"flex items-center gap-1 text-gray-800 mt-1",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,r.jsxs)("p",{children:[new Date(n.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})," at ",new Date(n.created_at).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0})]})]})]}),n.creator_name&&(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Created By"}),(0,r.jsx)("p",{className:"text-gray-800 mt-1",children:n.creator_name})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3 mt-6 pt-4 border-t border-gray-100 md:flex-row flex-col sm:flex-row",children:["approved"===n.approval_status?(0,r.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-green-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})}),"This report has been approved and cannot be modified"]}):(n.approval_status,(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l(),{href:"/reports/edit?id=".concat(n.id),className:"btn btn-secondary hover:bg-gray-100 transition-all duration-300 flex items-center w-full sm:w-auto justify-center sm:justify-start",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),"Edit Report"]}),(0,r.jsxs)("button",{onClick:A,className:"btn bg-red-50 text-red-600 border border-red-200 hover:bg-red-100 transition-all duration-300 flex items-center w-full sm:w-auto justify-center sm:justify-start",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Report"]})]})),n.approval_status&&(0,r.jsx)("div",{className:"flex flex-col md:items-end ml-auto w-full md:w-auto mt-4 md:mt-0",children:(0,r.jsxs)("div",{className:"space-y-2 max-w-full",children:[(0,r.jsx)("div",{className:"flex items-center px-3 py-1.5 rounded-md text-sm ".concat("approved"===n.approval_status?"bg-green-50 text-green-700":"rejected"===n.approval_status?"bg-red-50 text-red-700":"bg-gray-50 text-gray-600"),children:"approved"===n.approval_status?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,r.jsx)("span",{children:"Approved by landlord"})]}):"rejected"===n.approval_status?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,r.jsx)("span",{children:"Rejected by landlord"})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1.5 flex-shrink-0",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("span",{children:"Pending landlord approval"})]})}),"rejected"===n.approval_status&&n.rejection_message&&(0,r.jsxs)("div",{className:"px-3 py-2 bg-red-50 text-red-700 text-sm rounded-md border border-red-200 break-words",children:[(0,r.jsx)("p",{className:"font-medium mb-1",children:"Rejection Reason:"}),(0,r.jsx)("p",{className:"text-red-600 whitespace-normal",children:n.rejection_message})]})]})})]})]})]}),(0,r.jsxs)("div",{className:"mt-8",children:[(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsx)("h2",{className:"text-xl font-semibold text-indigo-700",children:"Photos"})}),j?(0,r.jsx)("div",{className:"flex justify-center items-center py-12",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):0===f.length?(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 p-6 text-center",children:(0,r.jsxs)("div",{className:"py-8",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-gray-300 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"No Photos Yet"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Add photos to document the condition of your property"}),(0,r.jsx)(l(),{href:"/reports/".concat(n.id,"/photos/add"),className:"btn btn-primary hover:bg-indigo-500 transition-all duration-300",children:"Add First Photo"})]})}):(0,r.jsx)("div",{children:(()=>{let e={},t=[];return f.forEach(o=>{if(o.tags&&o.tags.length>0){let r=o.tags.find(e=>e.includes("Bedroom")||e.includes("Bathroom")||e.includes("Living Room")||e.includes("Kitchen")||e.includes("Balcony")||e.includes("Garage")||e.includes("Garden")||e.includes("Patio")||e.includes("Basement")||e.includes("Attic")||e.includes("Terrace")||e.includes("Pool"));r?(e[r]||(e[r]=[]),e[r].push(o)):t.push(o)}else t.push(o)}),(0,r.jsxs)("div",{className:"space-y-8",children:[Object.entries(e).map((e,t)=>{let[o,a]=e;return(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium flex items-center",children:[(0,r.jsx)("span",{className:"w-2 h-6 bg-green-500 rounded-full mr-2"}),o," (",a.length," photo",1!==a.length?"s":"",")"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:a.map(e=>{if(!e||!e.id)return console.error("Invalid photo object:",e),null;let t=e.imgSrc||"/images/placeholder-image.svg",a=e.fallbackUrls||["".concat(x,"/uploads/").concat(e.file_path),"".concat(p,"/uploads/").concat(e.file_path),"".concat(x,"/api/photos/public-access/").concat(e.file_path),"".concat(p,"/api/photos/public-access/").concat(e.file_path),"/images/placeholder-image.svg"];return(0,r.jsxs)("div",{className:"group bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 hover:shadow-md transition-all duration-200",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(l(),{href:"/photos/".concat(e.id),children:(0,r.jsxs)("div",{className:"aspect-square overflow-hidden",style:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#f9f9f9"},children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 z-0",children:(0,r.jsx)("div",{className:"animate-pulse rounded-full h-10 w-10 border-2 border-indigo-500"})}),(0,r.jsx)("img",{src:t,alt:e.note||"Report photo",crossOrigin:"anonymous",onError:e=>{if(console.error("Image loading error for:",e.target.src),!a||!Array.isArray(a)){console.error("No fallback URLs available"),e.target.src="/images/placeholder-image.svg",e.target.onerror=null;return}let t=a.indexOf(e.target.src);if(-1!==t&&t<a.length-1){let o=a[t+1];console.log("Trying next URL (".concat(t+2,"/").concat(a.length,"): ").concat(o)),e.target.src=o}else console.log("All URLs failed, using placeholder image"),e.target.src="/images/placeholder-image.svg",e.target.onerror=null},onLoad:e=>{let t=e.target.previousSibling;t&&(t.style.display="none")},className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300 z-10 relative"})]})}),(0,r.jsx)("button",{onClick:()=>R(e.id),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Delete photo",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(e.note||e.tags&&e.tags.length>0)&&(0,r.jsxs)("div",{className:"p-2 bg-gray-50 text-xs",children:[e.note&&(0,r.jsx)("p",{className:"text-gray-700 truncate",title:e.note,children:e.note}),e.tags&&e.tags.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1 max-w-full overflow-hidden",children:[e.tags.filter(e=>e!==o).slice(0,2).map((e,t)=>(0,r.jsx)("span",{className:"inline-flex items-center text-xs bg-indigo-50 text-indigo-700 rounded px-1.5 py-0.5 truncate max-w-[80px]",title:e,children:e},t)),e.tags.filter(e=>e!==o).length>2&&(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.tags.filter(e=>e!==o).length-2]})]})]})]},e.id)})})]},t)}),t.length>0&&(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium flex items-center",children:[(0,r.jsx)("span",{className:"w-2 h-6 bg-gray-400 rounded-full mr-2"}),"Other Photos (",t.length," photo",1!==t.length?"s":"",")"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:t.map(e=>{if(!e||!e.id)return console.error("Invalid photo object:",e),null;let t=e.imgSrc||"/images/placeholder-image.svg",o=e.fallbackUrls||["".concat(x,"/uploads/").concat(e.file_path),"".concat(p,"/uploads/").concat(e.file_path),"".concat(x,"/api/photos/public-access/").concat(e.file_path),"".concat(p,"/api/photos/public-access/").concat(e.file_path),"/images/placeholder-image.svg"];return(0,r.jsxs)("div",{className:"group bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100 hover:shadow-md transition-all duration-200",children:[(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(l(),{href:"/photos/".concat(e.id),children:(0,r.jsxs)("div",{className:"aspect-square overflow-hidden",style:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#f9f9f9"},children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 z-0",children:(0,r.jsx)("div",{className:"animate-pulse rounded-full h-10 w-10 border-2 border-indigo-500"})}),(0,r.jsx)("img",{src:t,alt:e.note||"Report photo",crossOrigin:"anonymous",onError:e=>{if(console.error("Image loading error for:",e.target.src),!o||!Array.isArray(o)){console.error("No fallback URLs available"),e.target.src="/images/placeholder-image.svg",e.target.onerror=null;return}let t=o.indexOf(e.target.src);if(-1!==t&&t<o.length-1){let r=o[t+1];console.log("Trying next URL (".concat(t+2,"/").concat(o.length,"): ").concat(r)),e.target.src=r}else console.log("All URLs failed, using placeholder image"),e.target.src="/images/placeholder-image.svg",e.target.onerror=null},onLoad:e=>{let t=e.target.previousSibling;t&&(t.style.display="none")},className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300 z-10 relative"})]})}),(0,r.jsx)("button",{onClick:()=>R(e.id),className:"absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center shadow-md opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Delete photo",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(e.note||e.tags&&e.tags.length>0)&&(0,r.jsxs)("div",{className:"p-2 bg-gray-50 text-xs",children:[e.note&&(0,r.jsx)("p",{className:"text-gray-700 truncate",title:e.note,children:e.note}),e.tags&&e.tags.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-1 max-w-full overflow-hidden",children:[e.tags.slice(0,2).map((e,t)=>(0,r.jsx)("span",{className:"inline-flex items-center text-xs bg-indigo-50 text-indigo-700 rounded px-1.5 py-0.5 truncate max-w-[80px]",title:e,children:e},t)),e.tags.length>2&&(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.tags.length-2]})]})]})]},e.id)})})]})]})})()})]})]})}):(0,r.jsx)(i.Z,{children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl animate-fadeIn",children:[(0,r.jsxs)("div",{className:"flex items-center mb-6",children:[(0,r.jsx)("button",{onClick:()=>D.back(),className:"mr-4 text-gray-600 hover:text-gray-900","aria-label":"Back",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-indigo-700",children:"Report Not Found"})]}),(0,r.jsx)("div",{className:"bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100 p-6 text-center",children:(0,r.jsxs)("div",{className:"py-8",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 mx-auto text-gray-300 mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-800 mb-2",children:"Report Not Found"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"The requested report was not found or you don't have access to it."}),(0,r.jsx)(l(),{href:"/reports",className:"btn btn-primary hover:bg-indigo-500 transition-all duration-300",children:"Back to My Reports"})]})})]})})}}},function(e){e.O(0,[1664,1674,2888,9774,179],function(){return e(e.s=7849)}),_N_E=e.O()}]);